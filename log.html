<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthchievements ‚Äî Quest Log</title>

    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* ===== Same base variables as index.html for consistency ===== */
        :root {
            --primary: #7c3aed;
            --primary-light: #a78bfa;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-light: #f1f5f9;
            --text-muted: #94a3b8;
            --font-pixel: 'Press Start 2P', cursive;
            --font-body: 'Quicksand', sans-serif;
            --border-glow: 0 0 15px rgba(124, 58, 237, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-body);
            background: var(--bg-dark);
            color: var(--text-light);
            min-height: 100vh;
        }

        /* --- NAV (same as index.html) --- */
        nav {
            background: rgba(15, 23, 42, 0.95);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            position: sticky; top: 0; z-index: 100;
        }
        .logo { font-family: var(--font-pixel); font-size: 14px; color: var(--accent); text-decoration: none; }
        .logo span { color: var(--secondary); }
        .nav-links { display: flex; gap: 20px; list-style: none; flex-wrap: wrap; }
        .nav-links a { color: var(--text-muted); text-decoration: none; font-weight: 600; font-size: 14px; padding: 8px 14px; border-radius: 8px; transition: all 0.3s ease; }
        .nav-links a:hover { color: var(--text-light); background: var(--bg-card); }
        .nav-links .btn-start { background: var(--primary); color: white; border-radius: 20px; }

        /* --- PAGE HEADER --- */
        .page-header {
            text-align: center;
            padding: 40px 20px 20px;
        }
        .page-header h1 {
            font-family: var(--font-pixel);
            font-size: clamp(16px, 3vw, 24px);
            color: var(--accent);
            margin-bottom: 10px;
        }
        .page-header p {
            color: var(--text-muted);
            font-size: 16px;
        }

        /* --- FORM CONTAINER --- */
        .form-container {
            max-width: 700px;
            margin: 20px auto 60px;
            padding: 0 20px;
        }

        /* Each section of the form is a "quest" */
        .quest-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            transition: border-color 0.3s;
        }

        .quest-section:hover {
            border-color: var(--primary);
        }

        .quest-section h2 {
            font-family: var(--font-pixel);
            font-size: 11px;
            color: var(--primary-light);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* --- FORM FIELDS --- */
        .field-group {
            margin-bottom: 18px;
        }

        label {
            display: block;
            font-weight: 700;
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-dark);
            border: 2px solid var(--bg-card-hover);
            border-radius: 10px;
            color: var(--text-light);
            font-family: var(--font-body);
            font-size: 15px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: var(--border-glow);
        }

        /* Style for the date input */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1); /* Makes the calendar icon white */
        }

        /* Row with two fields side by side */
        .field-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* --- VALIDATION ERROR MESSAGES --- */
        /* These are hidden by default and shown by JavaScript */
        .error-message {
            color: var(--danger);
            font-size: 12px;
            margin-top: 4px;
            display: none; /* Hidden until JS shows it */
        }

        .error-message.show {
            display: block;
        }

        /* Red border on invalid fields */
        input.invalid, select.invalid {
            border-color: var(--danger);
        }

        /* --- TOGGLE FOR MENSTRUAL TRACKING --- */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        /* Hide the default checkbox */
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* Custom toggle slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-card-hover);
            border-radius: 26px;
            transition: 0.3s;
        }

        .slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        /* When checked, slide the circle and change color */
        .toggle-switch input:checked + .slider {
            background: var(--secondary);
        }

        .toggle-switch input:checked + .slider::before {
            transform: translateX(24px);
        }

        /* The hidden menstrual section */
        .menstrual-fields {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--bg-card-hover);
        }

        .menstrual-fields.show {
            display: block;
        }

        /* --- SUBMIT BUTTON --- */
        .btn-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-family: var(--font-pixel);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.4);
        }

        /* --- SUCCESS MESSAGE (shown after saving) --- */
        .success-popup {
            display: none; /* Hidden by default */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 2px solid var(--secondary);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 200;
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.3);
        }

        .success-popup.show {
            display: block;
            animation: popIn 0.4s ease;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .success-popup h2 {
            font-family: var(--font-pixel);
            font-size: 14px;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .success-popup p {
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .success-popup button {
            padding: 10px 25px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
        }

        /* Overlay behind the popup */
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 199;
        }

        .overlay.show {
            display: block;
        }

        /* --- BMI AUTO-CALC INFO --- */
        .bmi-display {
            background: var(--bg-dark);
            border: 2px dashed var(--accent);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            margin-top: 10px;
        }

        .bmi-display span {
            font-family: var(--font-pixel);
            font-size: 18px;
            color: var(--accent);
        }

        .bmi-category {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* --- FOOTER --- */
        footer {
            text-align: center;
            padding: 30px 20px;
            border-top: 1px solid var(--bg-card);
            color: var(--text-muted);
            font-size: 13px;
        }
        footer a { color: var(--primary-light); text-decoration: none; }

        @media (max-width: 768px) {
            nav { flex-direction: column; gap: 15px; }
            .nav-links { justify-content: center; }
            .field-row { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>

    <!-- NAVIGATION -->
    <nav>
        <a href="index.html" class="logo">Health<span>chievements</span></a>
        <ul class="nav-links">
            <li><a href="index.html">üè† Home Base</a></li>
            <li><a href="dashboard.html">üìä Dashboard</a></li>
            <li><a href="log.html">üìù Quest Log</a></li>
            <li><a href="history.html">üìú History</a></li>
            <li><a href="tips.html">üí° Power-Ups</a></li>
            <li><a href="profile.html">üë§ Profile</a></li>
        </ul>
    </nav>

    <!-- PAGE HEADER -->
    <div class="page-header">
        <h1>üìù Quest Log ‚Äî Record Your Stats</h1>
        <p>Enter your health data to earn XP and track your progress, brave adventurer!</p>
    </div>

    <!-- MAIN FORM -->
    <div class="form-container">
        <!-- We use onsubmit to call our validation function instead of default form submit -->
        <form id="healthForm" onsubmit="return handleSubmit(event)">

            <!-- SECTION 1: Basic Info -->
            <div class="quest-section">
                <h2>üóìÔ∏è Quest Details</h2>

                <div class="field-group">
                    <label for="questDate">üìÖ Quest Date</label>
                    <input type="date" id="questDate" required>
                    <div class="error-message" id="error-date">Please select a valid date!</div>
                </div>

                <div class="field-group">
                    <label for="playerName">üéÆ Player Name</label>
                    <input type="text" id="playerName" placeholder="Enter your hero name..." required>
                    <div class="error-message" id="error-name">Your hero needs a name! (At least 2 characters)</div>
                </div>
            </div>

            <!-- SECTION 2: Body Stats -->
            <div class="quest-section">
                <h2>üìè Body Stats ‚Äî Character Attributes</h2>

                <div class="field-row">
                    <div class="field-group">
                        <label for="height">üìê Height (cm)</label>
                        <input type="number" id="height" placeholder="e.g. 170" min="50" max="300" step="0.1"
                               oninput="calculateBMI()">
                        <div class="error-message" id="error-height">Height must be between 50-300 cm!</div>
                    </div>

                    <div class="field-group">
                        <label for="weight">‚öñÔ∏è Weight (kg)</label>
                        <input type="number" id="weight" placeholder="e.g. 65" min="10" max="500" step="0.1"
                               oninput="calculateBMI()">
                        <div class="error-message" id="error-weight">Weight must be between 10-500 kg!</div>
                    </div>
                </div>

                <!-- BMI is calculated automatically from height and weight -->
                <div class="bmi-display">
                    <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 5px;">
                        ‚ö° BMI (Auto-Calculated Power Level)
                    </p>
                    <span id="bmiValue">--</span>
                    <p class="bmi-category" id="bmiCategory">Enter height & weight to see your power level</p>
                </div>
            </div>

            <!-- SECTION 3: Vital Signs -->
            <div class="quest-section">
                <h2>‚ù§Ô∏è Vital Signs ‚Äî HP Stats</h2>

                <div class="field-group">
                    <label for="heartRate">üíì Heart Rate (bpm)</label>
                    <input type="number" id="heartRate" placeholder="e.g. 72" min="30" max="250">
                    <div class="error-message" id="error-hr">Heart rate should be between 30-250 bpm!</div>
                </div>
            </div>

            <!-- SECTION 4: Sleep -->
            <div class="quest-section">
                <h2>üò¥ Rest Phase ‚Äî Sleep Pattern</h2>

                <div class="field-row">
                    <div class="field-group">
                        <label for="sleepHours">üõå Hours of Sleep</label>
                        <input type="number" id="sleepHours" placeholder="e.g. 8" min="0" max="24" step="0.5">
                        <div class="error-message" id="error-sleep">Sleep hours must be between 0-24!</div>
                    </div>

                    <div class="field-group">
                        <label for="sleepQuality">‚≠ê Sleep Quality</label>
                        <select id="sleepQuality">
                            <option value="">-- Select Rating --</option>
                            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Legendary Rest</option>
                            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Great Rest</option>
                            <option value="3">‚≠ê‚≠ê‚≠ê Average Rest</option>
                            <option value="2">‚≠ê‚≠ê Poor Rest</option>
                            <option value="1">‚≠ê Terrible Rest</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- SECTION 5: Menstrual Cycle (Optional, Toggle-based) -->
            <div class="quest-section">
                <h2>üå∏ Cycle Tracking ‚Äî Optional Side Quest</h2>

                <!-- Toggle switch to show/hide menstrual fields -->
                <div class="toggle-container">
                    <label class="toggle-switch">
                        <input type="checkbox" id="cycleToggle" onchange="toggleCycleFields()">
                        <span class="slider"></span>
                    </label>
                    <span style="font-size: 14px; color: var(--text-muted);">
                        Enable Menstrual Cycle Tracking
                    </span>
                </div>

                <!-- These fields are hidden until the toggle is on -->
                <div class="menstrual-fields" id="menstrualFields">
                    <div class="field-group">
                        <label for="cycleStart">üóìÔ∏è Cycle Start Date</label>
                        <input type="date" id="cycleStart">
                    </div>

                    <div class="field-row">
                        <div class="field-group">
                            <label for="cycleLength">üìè Cycle Length (days)</label>
                            <input type="number" id="cycleLength" placeholder="e.g. 28" min="15" max="50">
                        </div>

                        <div class="field-group">
                            <label for="cycleFlow">üíß Flow Intensity</label>
                            <select id="cycleFlow">
                                <option value="">-- Select --</option>
                                <option value="light">Light</option>
                                <option value="medium">Medium</option>
                                <option value="heavy">Heavy</option>
                            </select>
                        </div>
                    </div>

                    <div class="field-group">
                        <label for="cycleNotes">üìù Notes / Symptoms</label>
                        <textarea id="cycleNotes" rows="3" placeholder="Any symptoms, mood changes, etc..."></textarea>
                    </div>
                </div>
            </div>

            <!-- SUBMIT BUTTON -->
            <button type="submit" class="btn-submit">
                ‚öîÔ∏è SAVE QUEST LOG & EARN XP ‚öîÔ∏è
            </button>

        </form>
    </div>

    <!-- SUCCESS POPUP (hidden by default) -->
    <div class="overlay" id="overlay"></div>
    <div class="success-popup" id="successPopup">
        <h2>üèÜ Quest Complete!</h2>
        <p>Your health stats have been saved. You earned <strong style="color: var(--accent);">+50 XP!</strong></p>
        <button onclick="closePopup()">Continue Adventure ‚Üí</button>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>‚öîÔ∏è Healthchievements ¬© 2026 ‚öîÔ∏è</p>
        <p style="margin-top: 8px;">
            <a href="index.html">Home Base</a> ‚Ä¢
            <a href="dashboard.html">Dashboard</a> ‚Ä¢
            <a href="history.html">History</a>
        </p>
    </footer>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
        // =============================================
        // SET TODAY'S DATE AS DEFAULT
        // =============================================
        // This runs when the page loads.
        // new Date() gives us today. toISOString() turns it into "2026-02-08T..."
        // .split('T')[0] grabs just the "2026-02-08" part.
        document.getElementById('questDate').value = new Date().toISOString().split('T')[0];


        // =============================================
        // TOGGLE: Show/Hide Menstrual Cycle Fields
        // =============================================
        function toggleCycleFields() {
            // Get the checkbox and the fields container
            var checkbox = document.getElementById('cycleToggle');
            var fields = document.getElementById('menstrualFields');

            // If checked, show the fields; otherwise hide them
            if (checkbox.checked) {
                fields.classList.add('show');
            } else {
                fields.classList.remove('show');
            }
        }


        // =============================================
        // AUTO-CALCULATE BMI
        // =============================================
        // BMI formula: weight (kg) / (height in meters)^2
        // This runs every time the user types in height or weight fields.
        function calculateBMI() {
            var height = parseFloat(document.getElementById('height').value);
            var weight = parseFloat(document.getElementById('weight').value);
            var bmiDisplay = document.getElementById('bmiValue');
            var bmiCategory = document.getElementById('bmiCategory');

            // Only calculate if both values are valid numbers
            if (height > 0 && weight > 0) {
                var heightInMeters = height / 100; // Convert cm to meters
                var bmi = weight / (heightInMeters * heightInMeters);
                bmi = Math.round(bmi * 10) / 10; // Round to 1 decimal place

                bmiDisplay.textContent = bmi;

                // Determine the category based on BMI value
                if (bmi < 18.5) {
                    bmiCategory.textContent = 'üîµ Underweight ‚Äî Need more potions!';
                    bmiCategory.style.color = '#60a5fa';
                } else if (bmi < 25) {
                    bmiCategory.textContent = 'üü¢ Normal ‚Äî Perfectly balanced, like a true hero!';
                    bmiCategory.style.color = '#10b981';
                } else if (bmi < 30) {
                    bmiCategory.textContent = 'üü° Overweight ‚Äî Time for a training montage!';
                    bmiCategory.style.color = '#f59e0b';
                } else {
                    bmiCategory.textContent = 'üî¥ Obese ‚Äî Let\'s start a new fitness quest!';
                    bmiCategory.style.color = '#ef4444';
                }
            } else {
                bmiDisplay.textContent = '--';
                bmiCategory.textContent = 'Enter height & weight to see your power level';
                bmiCategory.style.color = 'var(--text-muted)';
            }
        }


        // =============================================
        // FORM VALIDATION
        // =============================================
        // This checks if the user entered valid data before saving.
        // Returns true if everything is okay, false if there are errors.
        function validateForm() {
            var isValid = true; // Start assuming everything is fine

            // --- Clear all previous errors ---
            // querySelectorAll finds ALL elements matching the CSS selector
            document.querySelectorAll('.error-message').forEach(function(el) {
                el.classList.remove('show');
            });
            document.querySelectorAll('.invalid').forEach(function(el) {
                el.classList.remove('invalid');
            });

            // --- Check Player Name ---
            var name = document.getElementById('playerName').value.trim();
            // trim() removes spaces from start and end
            if (name.length < 2) {
                showError('playerName', 'error-name');
                isValid = false;
            }

            // --- Check Date ---
            var date = document.getElementById('questDate').value;
            if (!date) {
                showError('questDate', 'error-date');
                isValid = false;
            }

            // --- Check Height (if filled in) ---
            var height = document.getElementById('height').value;
            if (height && (height < 50 || height > 300)) {
                showError('height', 'error-height');
                isValid = false;
            }

            // --- Check Weight (if filled in) ---
            var weight = document.getElementById('weight').value;
            if (weight && (weight < 10 || weight > 500)) {
                showError('weight', 'error-weight');
                isValid = false;
            }

            // --- Check Heart Rate (if filled in) ---
            var hr = document.getElementById('heartRate').value;
            if (hr && (hr < 30 || hr > 250)) {
                showError('heartRate', 'error-hr');
                isValid = false;
            }

            // --- Check Sleep Hours (if filled in) ---
            var sleep = document.getElementById('sleepHours').value;
            if (sleep && (sleep < 0 || sleep > 24)) {
                showError('sleepHours', 'error-sleep');
                isValid = false;
            }

            return isValid;
        }

        // Helper function: shows an error message next to a field
        function showError(inputId, errorId) {
            document.getElementById(inputId).classList.add('invalid');
            document.getElementById(errorId).classList.add('show');
        }


        // =============================================
        // HANDLE FORM SUBMISSION
        // =============================================
        function handleSubmit(event) {
            // Prevent the form from actually submitting (which would reload the page)
            event.preventDefault();

            // First, validate the form
            if (!validateForm()) {
                return false; // Stop here if validation failed
            }

            // --- Collect all form data into an object ---
            var healthData = {
                date: document.getElementById('questDate').value,
                playerName: document.getElementById('playerName').value.trim(),
                height: document.getElementById('height').value || null,
                weight: document.getElementById('weight').value || null,
                bmi: document.getElementById('bmiValue').textContent !== '--'
                    ? document.getElementById('bmiValue').textContent
                    : null,
                heartRate: document.getElementById('heartRate').value || null,
                sleepHours: document.getElementById('sleepHours').value || null,
                sleepQuality: document.getElementById('sleepQuality').value || null,
                // Menstrual data (only if toggle is on)
                cycleTracking: document.getElementById('cycleToggle').checked,
                cycleStart: document.getElementById('cycleStart').value || null,
                cycleLength: document.getElementById('cycleLength').value || null,
                cycleFlow: document.getElementById('cycleFlow').value || null,
                cycleNotes: document.getElementById('cycleNotes').value || null,
                // Metadata
                savedAt: new Date().toISOString(), // Timestamp of when it was saved
                xpEarned: 50
            };

            // --- Save to localStorage ---
            // localStorage lets us save data in the browser.
            // We store an ARRAY of entries, so we need to:
            // 1. Get the existing array (or start a new one)
            // 2. Add the new entry to the array
            // 3. Save it back

            var existingData = localStorage.getItem('healthQuestLog');
            // JSON.parse converts the stored text back into a JavaScript array
            var questLog = existingData ? JSON.parse(existingData) : [];

            // Add our new entry to the array
            questLog.push(healthData);

            // JSON.stringify converts the array back to text for storage
            localStorage.setItem('healthQuestLog', JSON.stringify(questLog));

            // --- Update XP ---
            var currentXP = parseInt(localStorage.getItem('totalXP')) || 0;
            currentXP += 50;
            localStorage.setItem('totalXP', currentXP.toString());

            // --- Show success popup! ---
            document.getElementById('successPopup').classList.add('show');
            document.getElementById('overlay').classList.add('show');

            return false; // Prevent default form behavior
        }


        // =============================================
        // CLOSE SUCCESS POPUP
        // =============================================
        function closePopup() {
            document.getElementById('successPopup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');

            // Reset the form for a new entry
            document.getElementById('healthForm').reset();
            document.getElementById('bmiValue').textContent = '--';
            document.getElementById('bmiCategory').textContent = 'Enter height & weight to see your power level';
            document.getElementById('menstrualFields').classList.remove('show');

            // Set today's date again
            document.getElementById('questDate').value = new Date().toISOString().split('T')[0];
        }
    </script>

</body>
</html>
